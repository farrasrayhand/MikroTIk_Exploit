import ipaddress
import paramiko
import socket
import errno
from getpass import getpass

ssh = paramiko.SSHClient()
ssh.set_missing_host_key_policy(paramiko.AutoAddPolicy())

subnet = ipaddress.IPv4Network('192.168.39.0/24')
ip_address = [str(ip) for ip in subnet.hosts()]

user = input("Input Username: ")
passw = getpass()

for ip in ip_address:
    try:
        ssh.connect(hostname=ip, username=user, password=passw)
        ssh.exec_command("system/reset-configuration no-defaults=yes skip-backup=yes")
    except socket.error as e:
        if e.errno == errno.EHOSTUNREACH:
            print(f"Device {ip} is down or unreachable. Skipping...")
    except Exception as e:
        print(f"An error occurred while connecting to {ip}: {str(e)}")
    finally:
        ssh.close()
        ssh = paramiko.SSHClient()
        ssh.set_missing_host_key_policy(paramiko.AutoAddPolicy())
